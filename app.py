(full updated canvas code here)